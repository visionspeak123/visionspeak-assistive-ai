{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigation - AI Laika</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        body {
        font-family: Arial, sans-serif;
        margin: 35%;
        margin-top: 0rem;
        padding: 0;
        background: white;
        color: blue;
        text-align: center;
        border: 2px solid blue;
        width: 408px;
        height: 697px;
        align-items: center;
        justify-items: center;
        }
        h1 {
            color: #3300ff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .navigation-container {
            padding: 0px;
            
        }
        .fas {
            color: #3300ff;
        }
        .fa {
            color: #3300ff;
        }
        .laika {
    max-width: 300px;
    width: 200%;
    height: auto;
    margin-bottom: 20px;
}    
.top-design,
        .bottom-design {
            position: absolute;
            width: 92px; /* Adjust the size */
            height: auto;
        }

        .top-design {
            top:0.0%;
            left: 19.55%;
            margin-right: 100px;
            margin-top: 0;
            transform: translateX(-50%);
        }
.bottom-design {
            bottom:3.9%;
            left: 38.5%;
            transform: translateX(-50%);
        }
        h3{
            text-align: center;
        }
    </style>
</head>
<body>

   
    
    <div class="navigation-container">
        <div class="top-design"></div>
        <img src="{% static 'images/lo.png' %}" height="75px" width="400px" alt="Top Design">
    </div>
        
        <video class="laika" autoplay loop muted>
            <source src="{% static 'video/navigate.mp4' %}" type="video/mp4">
            Your browser does not support the video tag.
        </video>
       <h3>Navigate effortlessly with Laika, your guide to real-time directions and insights</h3>
    </div>
    <div class="bottom-design">
        <img src="{% static 'images/dw.png' %}" height="75px" width="405px" alt="Bottom Design">
    </div>


    <script>
        window.onload = function() {
            var navigateUtterance = new SpeechSynthesisUtterance("Please tell me the name of the place you want to navigate to.");
        
            function setFemaleVoice() {
                var voices = window.speechSynthesis.getVoices();
                var femaleVoice = voices.find(voice =>
                    voice.name.toLowerCase().includes("zira")
                );
                
                if (femaleVoice) {
                    navigateUtterance.voice = femaleVoice;
                }
                
                window.speechSynthesis.speak(navigateUtterance);
        
                navigateUtterance.onend = function() {
                    startListening();
                };
            }
        
            if (window.speechSynthesis.getVoices().length === 0) {
                window.speechSynthesis.onvoiceschanged = setFemaleVoice;
            } else {
                setFemaleVoice();
            }
        };

        function getCSRFToken() {
            var csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
            return csrfToken;
        }

        function handleCommand(command) {
            command = command.toLowerCase();
        
            if (command.includes('navigate to')) {
        const placeName = command.replace('navigate to', '').trim();
        if (placeName) {
            fetch('/place_info/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ command: `navigate to ${placeName}` })
            })
            .then(response => response.json())
            .then(data => {
                speak(data.info); // Speak the place information
                if (data.url) {
                    window.open(data.url, '_blank'); // Open the location in a new tab
                }
            })
            .catch(error => console.error('Error:', error));
        }
        navigate = true;
     } else {
                speak("I didn't catch that. Please try again.");
            }
        }
        
        function startListening() {
            var recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'en-US';
            recognition.interimResults = false;
        
            recognition.onresult = function(event) {
                var command = event.results[0][0].transcript.toLowerCase();
                handleCommand(command);
            };
        
            recognition.onerror = function(event) {
                console.error('Speech recognition error:', event.error);
            };
        
            recognition.onend = function() {
                startListening(); // Restart listening immediately
            };
        
            recognition.start();
        }

        function speak(message) {
            window.speechSynthesis.cancel();

            var utterance = new SpeechSynthesisUtterance(message);
            var voices = window.speechSynthesis.getVoices();
            var femaleVoice = voices.find(voice =>
                voice.name.toLowerCase().includes("zira")
            );

            if (femaleVoice) {
                utterance.voice = femaleVoice;
            }

            utterance.rate = 1.5;
            utterance.pitch = 1.5;
            utterance.volume = 1;

            utterance.onend = function () {
                console.log('Speech has finished.');
            };

            utterance.onerror = function (event) {
                console.error('Speech synthesis error:', event.error);
            };

            window.speechSynthesis.speak(utterance);
        }
        
    </script>
    
</body>
</html>
